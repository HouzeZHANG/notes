# Computer Networking Ma

---

问题：
1. IP地址只有32位？会不会不够用呐。。。32位二进制差不多大概是42亿的数量级
2. SMTP的7位ASCII限制是什么样的？
3. [telnet serverName 25](#231smtpsimple-mail-transfer-protocol)

---

## 2.应用层

### 2.1应用层协议原理

#### 2.1.1网络应用程序体系结构

现今有两种主流的应用程序体系结构(application architecture)，其一为对等体系结构，其二为客户-服务器体系结构。

运用**客户机-服务器**体系结构搭建的程序体系结构，**客户机之间不相互通信**。比如在web中，浏览器之间不直接通信。其次，服务器有公开的IP地址。

**P2P**技术是去中心化的：迅雷和torrent都是是P2P技术

#### 2.1.2进程通信

本书关注运行在不同系统上的进程之间的通信。运行在不同端系统上的进程通过交换**报文message**进行通信。在P2P模型中也使用client和server进行描述。

>服务器和客户机（应用程序的客户端&服务器端）的定义：在一对进程之间的绘画场景中，发起通信的进程被标记为客户，会话开始时等待联系的进程是服务器。

**进程**通过**socket套接字接口**从网络中获取报文&发送报文。套接字像房子的门。套接字是同一台主机中，应用层和运输层之间的接口。socket随即成为程序和网络之间的**应用程序编程接口(API)**

事实上开发人员对运输层的控制是非常有限的，包括但不限于选择传输层协议

***进程寻址***：[IP地址IP adress]+[端口号 port number]

IP地址是一个32位比特的量且能够唯一标识该主机

#### 2.1.3运输服务（分析传输层服务的四个维度）

分析运输服务的四个维度：**可靠数据传输、吞吐量、定时和安全性**

##### 可靠数据传输 Reliable data transfer

保证传输的数据100%准确

与之相对，**容忍丢失的应用**（loss-tolerant application）能接受数据的差错。比如说音视频应用。

##### 吞吐量

**可用吞吐量**：发送进程向接收进程**交付比特的速率**。

**带宽敏感的应用**（bandwidth-sensitive application）对吞吐量有要求

**弹性应用**（elastic application）根据当时可用的带宽或多或少地利用可供使用的吞吐量。比如电子邮件，文件传输，以及Web传送

##### 定时

对数据交付有严格的时间限制

在虚拟世界，因特网电话，多方游戏等领域，定时很重要

##### 安全性

发送主机加密数据、检查数据完整性和端点鉴别

事实上，无论是TCP还是UDP，（**事实上他俩都没有加密服务**），数据全部由明文传输。于是乎便诞生了SSL，**安全套接字层**（Secure Sockets Layer）为了解决TCP的安全性问题。SSL是对TCP的加强，而不是第三种传输层服务，**SSL位于应用层实现**，是TCP的扩展。

若要使用SSL服务，应用层的开发人员只需要**向SSL的API发送明文**即可，SSL会自动加密，由TCP套接字传递给传输层

#### 2.1.4因特网所提供的运输服务

因特网（TCP/IP架构）为应用层提供两个传输层协议——[TCP](#tcp)和[UDP]

##### TCP

TCP提供[面向连接](#面向连接)的服务和[可靠数据传输](#可靠数据传输服务)服务

##### 面向连接

在大量数据进行传输之前，客户机和服务器先进行**握手**，随后一个**TCP连接**（TCP connection）就在两个套接字之间建立了。该TCP连接是**全双工**的。

##### 可靠数据传输服务

无差错按照适当顺序交付数据

##### 拥塞控制机制

当网络出现堵塞，拥塞控制机制抑制发送进程，拥塞控制机制试图限制每一个TCP连接，使它们达到公平共享网络带宽的目的

#### 2.1.5应用层协议

### 2.3因特网中的电子邮件

一种**异步通信媒介**，当人们方便的时候就可以收发邮件，不必与他人的计划进行协调

三个主要的组成部分：**用户代理**user agent，**邮件服务器**mail server，**简单邮件传输协议**Simple mail transfer protocol SMTP

![因特网电子邮件组成](https://img-blog.csdnimg.cn/2eacbfd1873143d9bb8f5f15634aeca5.png)

#### 用户代理

**用户代理**：**代表一个人的计算机程序**，当浏览器发送请求的时候，会包含一个表明身份的user agent用户代理HTTP协议头。在因特网电子邮件下，则是**apple mail**或**outlook**程序

用户代理允许用户**阅读，回复，转发，保存和撰写**报文

当Alice撰写玩邮件后，**用户代理**向**邮件服务器**发送邮件，此时邮件放在服务器的**外出报文队列**（message queue）中，当Bob要阅读报文，用户代理在邮件服务器的邮箱中取得报文（当然使用用户名和口令来鉴别身份）

在服务器端，也就是收件服务器上收到新的报文时，SMTP服务器会将邮件存储在**mailbox邮箱**中，当用户想查看邮箱时，代理随即从服务器上**拉取**数据

**邮箱**（mailbox）：被安放在某个邮件服务器上，邮箱里的数据并不在代理上！

#### 2.3.1SMTP(Simple Mail Transfer Protocol)

**SMTP**是**应用层**协议，使用**TCP**进行可靠传输，从发送方的邮件服务器（**25**端口）向接收方的邮件服务器发送邮件。SMTP协议同时运行在**发送端**（客户端）以及**接收邮件的服务器端**

SMTP有**7位ASCII限制**，对大附件，图片音频甚至视频的传输能力堪忧，在发送和接收端需要对其进行**编解码**，这就是为什么每次传大照片都要上传那么久的原因

SMTP**不使用中间邮件服务器**，发件服务器向收件服务器直接传输，如果发件SMTP服务器传输失败，则会重新进入外出报文队列，等待重新发送，TCP则保障了可靠传输

#### 2.3.2邮件报文格式

